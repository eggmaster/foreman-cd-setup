# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
text
url --url=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/x86_64/os/ --proxy=http://192.168.203.1:3128
lang en_US.UTF-8
keyboard us
network --onboot=yes --device=eth0 --bootproto=static --ip=192.168.203.20 --netmask=255.255.255.0 --gateway=192.168.203.1 --hostname=foremancd.cdnet
network --onboot=yes --device=eth1 --bootproto=static --ip=192.168.202.20 --netmask=255.255.255.0
rootpw  --iscrypted $1$rhoscd$dzUErDguC6DLw44lI6XB.1
firewall --service=ssh,tftp --port=80,443,547
authconfig --enableshadow --passalgo=sha512
selinux --permissive
timezone --utc America/New_York
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"

# disk layout
zerombr
clearpart --all --drives=vda
part pv.1 --grow --size=1 --ondrive=vda
volgroup VG-FOREMAN --pesize=4096 pv.1
part /boot --fstype=ext4 --size=512 --ondrive=vda
logvol / --fstype=ext4 --name=LV-OS --vgname=VG-FOREMAN --grow --size=10240
logvol swap --name=LV-Swap --vgname=VG-FOREMAN --size=4096


reboot

%packages
@base
@server-policy
git
emacs
%end

%post --log=/root/anaconda-post.log

cat <<'EOF' > /etc/yum.repos.d/rhel-repos.repo
[rhel-base]
name=RHEL6.4 base
baseurl=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/x86_64/os/
enabled=1
gpgcheck=0

[rhel-optional]
name=RHEL6.4 optional
baseurl=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/optional/x86_64/os/
enabled=1
gpgcheck=0
EOF

cat <<'EOF' > /etc/hosts
192.168.203.20 foremancd.cdnet
EOF

cat <<'EOF' > /etc/resolv.conf
nameserver 10.11.5.19
nameserver 10.5.30.160
search redhat.com
EOF

for pkg in http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm http://repos.fedorapeople.org/repos/openstack/openstack-havana/rdo-release-havana-7.noarch.rpm puppet packstack-modules-puppet foreman foreman-mysql foreman-installer foreman-plugin-simplify mysql-server  augeas  git ruby193-ruby; do
 echo "installing $pkg"
 yum -y install $pkg
 while [ $? -ne 0 ]; do
  yum -y install $pkg
 done
done


cat <<'EOF' > /root/setup-script.sh
#!/bin/bash

pushd /root
git clone https://github.com/redhat-openstack/astapor.git
popd

export PRIVATE_CONTROLLER_IP=192.168.200.20
export PRIVATE_INTERFACE=eth0
export PRIVATE_NETMASK=192.168.200.0/24
export PUBLIC_CONTROLLER_IP=192.168.201.20
export PUBLIC_INTERFACE=eth1
export PUBLIC_NETMASK=192.168.201.0/24
export FOREMAN_GATEWAY=192.168.202.20
export FOREMAN_PROVISIONING=true

pushd /root/astapor/bin
echo -e "\n" | bash -x foreman_server.sh
popd
EOF

chmod 700 /root/setup-script.sh

mkdir /root/.ssh
chmod 700 /root/.ssh
touch /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys

cat <<'EOF' >> /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA1zdAJQ8yQQrJfYUmlZi/CZmZpZeRNp+6NANUtFakXpVzGAXQXE+jezWq7XkQ3Vi0k8FIPmWSNyLy/DuSWw1kwg9PuTukb2UCfywTpFBgRPXExZdVH9/3RtsWoWsBVmrTwem/rng20i6z0P6eyByX5W2yDu7MXR2iWPnxol06y8WhHoU0dEl26fd8tdIfE4YamCe8mbufHsragaAXbFk8gl+gjU32I0xxJwjHeW9QNmw+PIoi7Jg6US4z3H7r3nn/lbKHA++z2bZ7amBlrrx/PY9iYFFj8aQacU27Irc7c4URKxRK3amgwYw3j+ZHNVmfHZEQnpb+ni72EjmOVQOgFw== rhos-ci@rhev-i16c-05.mpc.lab.eng.bos.redhat.com
EOF

%end
