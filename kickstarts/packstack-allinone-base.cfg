# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
text
url --url=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/x86_64/os/
lang en_US.UTF-8
keyboard us
%include /tmp/net-config
rootpw  --iscrypted $1$rhoscd$dzUErDguC6DLw44lI6XB.1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --permissive
timezone --utc America/New_York
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"

# disk layout
zerombr
clearpart --all --drives=vda
part pv.1 --grow --size=1 --ondrive=vda
volgroup VG-FOREMAN --pesize=4096 pv.1
part /boot --fstype=ext4 --size=512 --ondrive=vda
logvol / --fstype=ext4 --name=LV-OS --vgname=VG-FOREMAN --grow --size=10240
logvol swap --name=LV-Swap --vgname=VG-FOREMAN --size=4096
reboot

%packages
@base
@server-policy
git
emacs-nox
%end

%pre
set -- `cat /proc/cmdline`
for I in $*; do case "$I" in *=*) eval $I;; esac; done

cat <<EOF > /tmp/net-config
network --onboot=yes --device=eth0 --bootproto=static --ip=$FOREMAN_PUB.$GUEST_IP --netmask=255.255.255.0 --gateway=$FOREMAN_PUB.1 --hostname=$PACKSTACK_HOSTNAME
network --onboot=yes --device=eth1 --bootproto=static --ip=$OPENSTACK_PUB.$GUEST_IP --netmask=255.255.255.0 --gateway=$OPENSTACK_PUB.1
EOF

%end



%post --log=/root/anaconda-post.log
set -- `cat /proc/cmdline`
for I in $*; do case "$I" in *=*) eval $I;; esac; done

cat <<'EOF' > /etc/yum.repos.d/rhel-repos.repo
[rhel-base]
name=RHEL6.4 base
baseurl=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/x86_64/os/
enabled=1
gpgcheck=0

[rhel-optional]
name=RHEL6.4 optional
baseurl=http://download.devel.redhat.com/released/RHEL-6/6.4/Server/optional/x86_64/os/
enabled=1
gpgcheck=0
EOF

cat <<EOF > /etc/hosts
$FOREMAN_PUB.$GUEST_IP $PACKSTACK_HOSTNAME ${PACKSTACK_HOSTNAME%%.*}
EOF

cat <<EOF > /etc/resolv.conf
nameserver 10.11.5.19
nameserver 10.5.30.160
search redhat.com
EOF



for pkg in http://rdo.fedorapeople.org/rdo-release.rpm openstack-packstack; do
 echo "installing $pkg"
 yum -y install $pkg
 while [ $? -ne 0 ]; do
  yum -y install $pkg
 done
done

mkdir /root/.ssh
chmod 700 /root/.ssh
touch /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys

cat <<'EOF' >> /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA1zdAJQ8yQQrJfYUmlZi/CZmZpZeRNp+6NANUtFakXpVzGAXQXE+jezWq7XkQ3Vi0k8FIPmWSNyLy/DuSWw1kwg9PuTukb2UCfywTpFBgRPXExZdVH9/3RtsWoWsBVmrTwem/rng20i6z0P6eyByX5W2yDu7MXR2iWPnxol06y8WhHoU0dEl26fd8tdIfE4YamCe8mbufHsragaAXbFk8gl+gjU32I0xxJwjHeW9QNmw+PIoi7Jg6US4z3H7r3nn/lbKHA++z2bZ7amBlrrx/PY9iYFFj8aQacU27Irc7c4URKxRK3amgwYw3j+ZHNVmfHZEQnpb+ni72EjmOVQOgFw== rhos-ci@rhev-i16c-05.mpc.lab.eng.bos.redhat.com
EOF

%end
